#include "API_delay.h"

static void Error_Handler(void);

static void Error_Handler(void)
{
	/* Turn LED2 on */
	BSP_LED_On(LED2);
	while (1)
	{
	}
}

void delayInit(delay_t *delay, tick_t duration)
{
   if (delay == NULL || duration == 0U) // Fault check
   {
      Error_Handler();
   }

   delay->duration = duration;
   delay->running  = false;
}

bool_t delayRead(delay_t *delay)
{
   bool_t _ret = false;

   if (delay == NULL) // Fault check
   {
      Error_Handler();
   }

   if (delay->running)
   {
      if (HAL_GetTick() - delay->startTime >= delay->duration)
      {
         delay->running = false;
         _ret = true;
      }      
   }
   else
   {
      delay->startTime = HAL_GetTick();
      delay->running   = true;
   }

   return _ret;         
}

void delayWrite(delay_t *delay, tick_t duration)
{
   if (delay == NULL || duration == 0U) // Fault check
   {
      Error_Handler();
   }

   delay->duration = duration;      
}
